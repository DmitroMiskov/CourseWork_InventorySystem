services:
  # 1. –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
  db:
    image: postgres:15-alpine
    container_name: inventory-db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_DB: inventory_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # 2. Backend API (–†–µ–∂–∏–º —Ä–æ–∑—Ä–æ–±–∫–∏)
  api:
    image: mcr.microsoft.com/dotnet/sdk:9.0
    container_name: inventory-api
    # üëá –í–∫–∞–∑—É—î–º–æ, –¥–µ –ª–µ–∂–∏—Ç—å .csproj, —â–æ–± –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É –±—É–ª–∞ –ø—Ä–æ—Å—Ç–æ—é
    working_dir: /app/src/Inventory.API
    depends_on:
      - db
    environment:
      - ASPNETCORE_URLS=http://+:8080
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Host=db;Port=5432;Database=inventory_db;Username=postgres;Password=password
    ports:
      - "8080:8080"
    volumes:
      # –ú–æ–Ω—Ç—É—î–º–æ –≤–µ—Å—å –∫–æ–¥, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞–≤ Hot Reload
      - ./src:/app/src
      # –ú–æ–Ω—Ç—É—î–º–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏, —â–æ–± –≤–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—è –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ
      - ./src/Inventory.API/wwwroot/images:/app/src/Inventory.API/wwwroot/images
    # üëá –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö)
    command: dotnet watch run --no-launch-profile

  # 3. Frontend (React + Vite Hot Reload)
  client:
    image: node:20-alpine
    container_name: inventory-client
    working_dir: /app
    depends_on:
      - api
    environment:
      # –í–∞–∂–ª–∏–≤–æ –¥–ª—è Windows, —â–æ–± –±–∞—á–∏—Ç–∏ –∑–º—ñ–Ω–∏ —Ñ–∞–π–ª—ñ–≤
      - CHOKIDAR_USEPOLLING=true
    ports:
      - "80:5173" # –ó–æ–≤–Ω—ñ –ø–æ—Ä—Ç 80 -> –í—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ—Ä—Ç 5173 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç Vite)
    volumes:
      # üëá –í–ò–ü–†–ê–í–õ–ï–ù–û: –í–∞—à–∞ –ø–∞–ø–∫–∞ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è 'frontend', –∞ –Ω–µ 'client'
      - ./frontend:/app
      # –¶–µ —â–æ–± node_modules –Ω–µ –∑–∞—Ç–∏—Ä–∞–ª–∏—Å—è –ø—Ä–∏ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—ñ
      - /app/node_modules
    # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–∞–∫–µ—Ç–∏ —ñ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä —Ä–æ–∑—Ä–æ–±–∫–∏
    command: sh -c "npm install && npm run dev -- --host"

volumes:
  postgres_data: